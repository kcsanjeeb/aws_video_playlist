<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.834.0.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous"></head>
    <style>
        body{
            background-color: whitesmoke;
            overflow: hidden;
        }
        .small_img{
            width: 100%;
            height:100px
        }
        #videoarea{
            width:100%;
            height:450px;
            border:1px solid grey
        }
        ul{
            height:500px;
            overflow: auto;
        }
        li{
            list-style: none;
        }
        .card{
            background-color: whitesmoke;
        }        
        .card-title{
          font-size: 15px;
          margin-bottom: 2px;
        }

    </style>
    
    <body>
    <!-- Image and text -->
<nav class="navbar navbar-dark bg-dark">
    <a class="navbar-brand" href="#">
      <img src="./logo.png" width="60" height="30" class="d-inline-block align-top mr-2" alt="">
      AWS VIDEO PLAYLIST
    </a>
           <button class="btn btn-light my-2 my-sm-0" type="submit" onclick="location.reload();
           ">Reload</button>
      
  </nav>
  <div class="container shadow-lg p-3 mb-5 bg-white rounded mt-4">
    <div id="demo"></div>
      <div class="row">
          <div class="col-lg-7 ">
            <video id="videoarea" class="bg-dark" controls="controls" poster="" src=""></video>
          
                <h4 id="moviename">Movie Name</h4>
     
        
          </div>
          <div class="col-lg-5">
         
            
              <ul id="playlist" class="pl-0" >
                
            </ul>

        </div>
       



        
      </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script></body>
  <script src="https://momentjs.com/downloads/moment.js"></script>

  <script>

    const last = moment(document.lastModified, "MM/DD/YYYY");
    const now = moment();



    function fetchawsdata(){
      fetch('http://localhost:3000/listVideos')
      .then((response) => {
        return response.json()
      })
      .then((data) => {
        console.log(data);
        var theNameWithExt = data[0].Key;
        document.getElementById("moviename").innerHTML =theNameWithExt.split("/").slice(-1).join().split(".").shift() ;  

        // var theNameWithExt = "filename sanjeeb .jpg";
        // theName = theNameWithExt.split("/").slice(-1).join().split(".").shift();
        // console.log(theName)
        
        // var n = new Date();
        // n.toISOString();
        // var date = moment(n.toISOString()).format('DD-MM-YYYY');
        // console.log(date);

        // console.log()
        for(var i=0;i<data.length;i++){
          var filename = data[i].Key.split("/").slice(-1).join().split(".").shift()
          console.log(filename)
          
          data.sort(function compare(a, b) {
            var dateA = new Date(a.date);
            var dateB = new Date(b.date);
            return dateA - dateB;
          });

          document.getElementById("playlist").innerHTML += `
          <li movieurl="https://awsvideoplaylist.s3.us-east-2.amazonaws.com/${data[i].Key}" moviesposter="./logo.png" moviename="${filename}">
                    <div class="card mb-3 shadow-sm">
                        <div class="row no-gutters">
                          <div class="col-md-4">
                            <img class="small_img" src="./logo.png" alt="...">
                          </div>
                          <div class="col-md-8">
                            <div class="card-body">
                              <h5 class="card-title">${filename}</h5>
                              <p class="card-text"><small class="text-muted">Last modified at ${data[i].LastModified}</small></p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </li>`;
          console.log(data[i].Key)
          $(function() {
    $("#playlist li").on("click", function() {
        console.log('hey')
        $("#videoarea").attr({
            "src": $(this).attr("movieurl"),
            // "autoplay": "autoplay",
            "poster":$(this).attr("moviesposter")
        })
        $("#moviename").html($(this).attr("moviename"));
    })
    $("#videoarea").attr({
        "src": $("#playlist li").eq(0).attr("movieurl"),
        "poster": $("#playlist li").eq(0).attr("moviesposter")
    })
    }) 
        }
       
      })
      .catch((err) => {
      })
    }
    fetchawsdata();
  </script>

  


    </html>